

OAuth 2.0ì—ì„œ "í´ë¼ì´ì–¸íŠ¸"ëŠ” ë‹¨ìˆœíˆ Authorization Serverë¡œë¶€í„° Access Tokenì„ ìš”ì²­í•  ìˆ˜ ìˆëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ì˜ë¯¸í•˜ë©°, 
ë°˜ë“œì‹œ í”„ë¡ íŠ¸ì—”ë“œì¼ í•„ìš”ëŠ” ì—†ë‹¤. ì„œë²„ì—ì„œ ì‹¤í–‰ë˜ëŠ” Confidential Clientì™€ ë¸Œë¼ìš°ì €, ëª¨ë°”ì¼ ë“±ì—ì„œ ì‹¤í–‰ë˜ëŠ” Public Clientë¡œ ë‚˜ë‰œë‹¤.
Grant Typeì€ ì´ëŸ¬í•œ ë‹¤ì–‘í•œ í™˜ê²½ì— ë§ê²Œ Access Tokenì„ ë°œê¸‰ë°›ëŠ” ë°©ì‹ì´ë©°, ëŒ€í‘œì ì¸ ìœ í˜•ì€ ë‹¤ìŒê³¼ ê°™ë‹¤.



                                OAuth 2.0 - Authorization Code (PKCE)


                           Authorization Code Grant 
                                     \ 
                                      \                   Authorization EP
                          /ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡\ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡â†’  Authorization
                        /       /ã…¡ã…¡ã…¡ã…¡\ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡      Server     â†ã…¡ã…¡ã…¡ã…¡\ JWKS EP
                      /        /          \      /ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡â†’                           \
                    1ï¸âƒ£       /              â†˜  /        Token EP        â†—       â†‘ Introspect EP  |
                    /       /                  /                       /        |                |
                   /      2ï¸âƒ£             Get Access token       User Info Ep    |                |
                 /       /                 /                    â—               |           Retrieve public   
     Get Authorization  /               3ï¸âƒ£                    â—                 |            Signing keys
               â—œ     Returns           /         Get User Information           |                  |
               \    Auth Code        /            (Open ID Connect)     Verify Access Token        |
                \     \             /            â—                      and retrieve scopes        |
                 \     â—ŸRedirection EP        4ï¸âƒ£                                 |                |
                   â—Ÿ    â†˜        /            /                                  6ï¸âƒ£               |
                     â—Ÿ  Client /             /                                    |               |
      ğŸ“±  ã…¡ã…¡ã…¡ã…¡â†’  Application  ã…¡ã…¡ã…¡ã…¡ã…¡/                                      |              7ï¸âƒ£
  User Agent                                                                      |              /
       â†‘   \               |                                                      |             /
       |    \              |     Call RESP API with Access Token                  |            /
      ğŸ™â€â™‚ï¸    \             |          (Returns Photos List)                        |          â—
   Resource   \            |ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡5ï¸âƒ£ ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡â†’  Resource Server   â—
     Owner     \                                                           
                \
              The Client application is running on
              a Browser, Desktop or Mobile. it's a 
              public Client


OAuth 2.0ì—ì„œ ë¸Œë¼ìš°ì €, ëª¨ë°”ì¼, ë°ìŠ¤í¬í†±ì²˜ëŸ¼ ë³´ì•ˆì´ ì•½í•œ í™˜ê²½ì—ì„œ ì‹¤í–‰ë˜ëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ì€ Public Clientë¡œ ë¶„ë¥˜ëœë‹¤. 
ì´ ê²½ìš° client_secretì„ ì•ˆì „í•˜ê²Œ ì €ì¥í•  ìˆ˜ ì—†ì–´ ê¸°ì¡´ Authorization Code Grant ë°©ì‹ë§Œìœ¼ë¡œëŠ” ë³´ì•ˆì´ ì·¨ì•½í•˜ë‹¤. 
ì´ë¥¼ ë³´ì™„í•˜ê¸° ìœ„í•´ ë“±ì¥í•œ ê²ƒì´ PKCE (Proof Key for Code Exchange) í™•ì¥ì´ë‹¤.

PKCEëŠ” í´ë¼ì´ì–¸íŠ¸ê°€ code_verifierë¥¼ ë™ì ìœ¼ë¡œ ìƒì„±í•˜ê³ , 
ì´ë¥¼ ê¸°ë°˜ìœ¼ë¡œ code_challengeë¥¼ ë§Œë“  ë’¤ Authorization ìš”ì²­ ì‹œ í•¨ê»˜ ì „ì†¡í•œë‹¤. 
Authorization ServerëŠ” ì´ ì •ë³´ë¥¼ ê¸°ì–µí•´ë‘ê³ , 
ì´í›„ í´ë¼ì´ì–¸íŠ¸ê°€ Access Tokenì„ ìš”ì²­í•  ë•Œ ë‹¤ì‹œ code_verifierë¥¼ ì œì¶œí•˜ë©´ ê·¸ê²ƒì„ ê²€ì¦í•˜ì—¬ ìœ íš¨í•œ ìš”ì²­ìì¸ì§€ íŒë‹¨í•œë‹¤. 
ì´ ë°©ì‹ì€ client_secret ì—†ì´ë„ ì•ˆì „í•˜ê²Œ ì¸ì¦ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆê²Œ í•´ì¤€ë‹¤.

ì´ëŠ” ë³´ì•ˆìƒ ìœ„í—˜í–ˆë˜ Implicit Grantë¥¼ ëŒ€ì²´í•˜ê¸° ìœ„í•´ ê¶Œì¥ë˜ëŠ” ë°©ì‹ì´ë©°, 
ëª¨ë°”ì¼ ì•±, SPA ë“± í”„ë¡ íŠ¸ í™˜ê²½ì—ì„œëŠ” ë°˜ë“œì‹œ PKCEë¥¼ ì ìš©í•œ Authorization Code Grantë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ê¶Œì¥ëœë‹¤.



                                OAuth 2.0 - Implicit (íê¸°ë¨)


                            Implicit Grant (Deprecated)

                                      
                                                         Authorization EP
                          /ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡â†’  Authorization
                        /       /ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡      Server     â†ã…¡ã…¡ã…¡ã…¡\ JWKS EP
                      /        /                /ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡â†’                           \
                    1ï¸âƒ£       /                /        Token EP        â†—       â†‘ Introspect EP  |
                    /       /                  /                       /        |                |
                   /      2ï¸âƒ£             Get Access token       User Info Ep    |                |
                 /       /                 /                    â—               |           Retrieve public   
     Get Authorization  /               3ï¸âƒ£                    â—                 |            Signing keys
               â—œ     Returns           /         Get User Information           |                  |
               \    Access Code      /            (Open ID Connect)     Verify Access Token        |
                \     \             /            â—                      and retrieve scopes        |
                 \     â—ŸRedirection EP        4ï¸âƒ£                                 |                |
                   â—Ÿ    â†˜        /            /                                  6ï¸âƒ£               |
                     â—Ÿ  Client /             /                                    |               |
      ğŸ“±  ã…¡ã…¡ã…¡ã…¡â†’  Application  ã…¡ã…¡ã…¡ã…¡ã…¡/                                      |              7ï¸âƒ£
  User Agent                                                                      |              /
       â†‘   \               |                                                      |             /
       |    \              |     Call RESP API with Access Token                  |            /
      ğŸ™â€â™‚ï¸    \             |          (Returns Photos List)                        |          â—
   Resource   \            |ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡5ï¸âƒ£ ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡â†’  Resource Server   â—
     Owner     \                                                           
                \
              The Client application is running on
              a Browser, Desktop or Mobile. it's a 
              public Client


Implicit GrantëŠ” ë¸Œë¼ìš°ì €, ëª¨ë°”ì¼ ë“± Public Client í™˜ê²½ì—ì„œ ê°„ë‹¨íˆ ì‚¬ìš©ë˜ë˜ ë°©ì‹ì´ì§€ë§Œ, 
ë³´ì•ˆìƒì˜ ì´ìœ ë¡œ í˜„ì¬ëŠ” íê¸°(deprecated)ë˜ì—ˆë‹¤. 
ì´ ë°©ì‹ì€ Authorization ìš”ì²­ì— ëŒ€í•œ ì‘ë‹µìœ¼ë¡œ Access Tokenì„ ì¦‰ì‹œ ë°˜í™˜í•˜ë©°, 
ì¤‘ê°„ì— Authorization Codeë¥¼ ê±°ì¹˜ì§€ ì•ŠëŠ”ë‹¤. ì¦‰, í† í°ì´ ì§ì ‘ URLì— í¬í•¨ë˜ì–´ ë¸Œë¼ìš°ì €ë¡œ ì „ë‹¬ë˜ë©°, ì´ëŠ” ì¤‘ê°„ì— íƒˆì·¨ë  ìˆ˜ ìˆëŠ” í° ìœ„í—˜ ìš”ì†Œë‹¤.

ê²Œë‹¤ê°€ ì´ ë°©ì‹ì€ Token Endpointë¥¼ ê±°ì¹˜ì§€ ì•Šê¸° ë•Œë¬¸ì— 
client_secret í™•ì¸, code_verifier ì‚¬ìš©, scope ê²€ì¦ ê°™ì€ ì¶”ê°€ ë³´ì•ˆ ì ˆì°¨ê°€ ì—†ë‹¤. 
ì´ëŸ¬í•œ ì´ìœ ë¡œ OAuth í‘œì¤€ì—ì„œëŠ” Implicit Grantë¥¼ ë” ì´ìƒ ì‚¬ìš©í•˜ì§€ ë§ê³ , PKCEë¥¼ ì ìš©í•œ Authorization Code Grantë¡œ ëŒ€ì²´í•  ê²ƒì„ ê¶Œì¥í•œë‹¤.

ì •ë¦¬í•˜ìë©´, Implicit GrantëŠ”

1. ë³´ì•ˆì´ ì•½í•œ í™˜ê²½(í”„ë¡ íŠ¸)ì—ì„œ ì‚¬ìš©
2. Access Tokenì„ ì§ì ‘ ë…¸ì¶œ (redirect URIì— í¬í•¨)
3. Token Endpointë¥¼ ìƒëµí•¨ìœ¼ë¡œì¨ ë³´ì•ˆ ê¸°ëŠ¥ ê²°ì—¬
4. í˜„ì¬ëŠ” PKCE ê¸°ë°˜ì˜ Authorization Code Grantê°€ ê³µì‹ ëŒ€ì²´ì•ˆ




                                    OAuth 2.0 - Client Credentials


                      Client Credentials Grant     
                                \
                                  â†˜     
                      /ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡â†’  Authorization
                Get Access token                                     Server      â†–
                    /                                                  â†‘           \
                   /                                                   |          Retrieve public
                 1ï¸âƒ£                                                     |           signing keys
                 /                                            Verify Access Token    |
          Client                                              and retrieve scopes    |
        Application                                                    |            4ï¸âƒ£
             |                                                         |            /
             |                                                        3ï¸âƒ£           /
             |     Call RESP API with Access Token                     |          /
             |          (Returns Photos List)                          |        â—
             |ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡2ï¸âƒ£ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡â†’   Resource Server   


Client Credentials GrantëŠ” ì‚¬ìš©ì(Resource Owner) ì—†ì´ ì„œë²„ ê°„ í†µì‹ ì—ì„œ ì‚¬ìš©ëœë‹¤. 
ë°±ì—”ë“œì—ì„œ client IDì™€ secretì„ Authorization Serverì— ì „ë‹¬í•´ Access Tokenì„ ë°›ê³ , 
ì´ë¥¼ í†µí•´ Resource Serverì— ì ‘ê·¼í•œë‹¤. ì£¼ë¡œ cron ì‘ì—…ì´ë‚˜ ì‹œìŠ¤í…œ ê°„ í†µì‹ ì— ì í•©í•˜ë‹¤.




                            OAuth 2.0 - Resource Owner Password Credentials (íê¸° ê¶Œì¥)

                           Client Credentials Grant     
                                     \
                                       â†˜     
                           /ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡â†’  Authorization  â†ã…¡ã…¡\
                     Get Access token                     Token EP   â†—   Server          \ JWKS EP
                         /                                         /       â†‘Introspect EP  \
                        /                                  User Info EP    |            Retrieve public
                      1ï¸âƒ£                  Get User Information /           |             signing keys
                      /                    (Open ID Connect) /      Verify Access Token     |
    ğŸ’»  ã…¡ã…¡ã…¡â†’  Client    ã…¡ã…¡ã…¡ã…¡ã…¡2ï¸âƒ£ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡/       and retrieve scopes       |
   User         Application                                                 |               5ï¸âƒ£
   Agent           |                                                        |               /
     â†‘             |                                                       4ï¸âƒ£              /
     |             |     Call RESP API with Access Token                    |            /
    ğŸ™â€â™‚ï¸            |          (Returns Photos List)                         |           / 
  Resource         |ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡3ï¸âƒ£ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡â†’   Resource Server  â—  
   Owner



ì‚¬ìš©ìì˜ ID/PWë¥¼ í´ë¼ì´ì–¸íŠ¸ê°€ ì§ì ‘ ë°›ì•„ í† í°ì„ ë°œê¸‰ë°›ëŠ” ë°©ì‹ìœ¼ë¡œ, 
3ì ì•±ì—ì„  ë³´ì•ˆ ìœ„í—˜ì´ ì»¤ì„œ ë” ì´ìƒ ê¶Œì¥ë˜ì§€ ì•ŠìŒ. 
ë™ì¼ ì¡°ì§ ë‚´ ì‹ ë¢°ëœ ì•±ì—ì„œë§Œ ì œí•œì ìœ¼ë¡œ ì‚¬ìš©. 
ì¼ë°˜ì ìœ¼ë¡œëŠ” Authorization Code Grant (PKCE í¬í•¨) ì‚¬ìš©ì„ ê¶Œì¥í•¨.





                                           OAuth 2.0 - Refresh Token

                           Authorization Code Grant 
                                     \ 
                                      \                   Authorization EP
                          /ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ \ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡â†’  Authorization
                        /       /ã…¡ã…¡ã…¡ã…¡\ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡      Server     â†ã…¡ã…¡ã…¡ã…¡\ JWKS EP
                      /        /          \      /ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡â†’     (Google)             \
                    1ï¸âƒ£       /              â†˜  /        Token EP        â†—       â†‘ Introspect EP  |
                    /       /                  /                       /        |                |
                   /      2ï¸âƒ£             Get Access token       User Info Ep    |                |
                 /       /                 /                    â—               |           Retrieve public   
     Get Authorization  /               3ï¸âƒ£                    â—                 |            Signing keys
               â—œ     Returns           /         Get User Information           |                  |
               \    Auth Code        /            (Open ID Connect)     Verify Access Token        |
                \     \             /            â—                      and retrieve scopes        |
                 \     â—ŸRedirection EP        4ï¸âƒ£                                 |                |
                   â—Ÿ    â†˜        /            /                                  6ï¸âƒ£               |
                     â—Ÿ  Client /             /                                    |               |
      ğŸ’»  ã…¡ã…¡ã…¡ã…¡â†’  Application  ã…¡ã…¡ã…¡ã…¡ã…¡/                                      |              7ï¸âƒ£
  User Agent         (Shutterfly)                                                 |              /
       â†‘                   |                                                      |             /
       |                   |     Call RESP API with Access Token                  |            /
      ğŸ™â€â™‚ï¸                  |          (Returns Photos List)                        |          â—
   Resource                |ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡5ï¸âƒ£ ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡â†’  Resource Server   â—
     Owner                                                                (Google Photos API)



Access Tokenì€ ìœ íš¨ê¸°ê°„ì´ ì§§ì•„(ì˜ˆ: 1ì‹œê°„), 
ë§Œë£Œ í›„ ì‚¬ìš©ìê°€ ë‹¤ì‹œ ë¡œê·¸ì¸í•˜ì§€ ì•Šë„ë¡ Refresh Tokenì„ í•¨ê»˜ ë°œê¸‰í•¨. 
Refresh Tokenìœ¼ë¡œ ìƒˆë¡œìš´ Access Tokenì„ ë°œê¸‰ë°›ì„ ìˆ˜ ìˆì–´ ì§€ì†ì ì¸ ì¸ì¦ ìœ ì§€ê°€ ê°€ëŠ¥í•¨. 
ì£¼ë¡œ Authorization Code Grantì™€ í•¨ê»˜ ì‚¬ìš©ë˜ë©°, ë³´ì•ˆìƒ ë¡œê·¸ì•„ì›ƒ ì‹œ ë‘ í† í° ëª¨ë‘ íê¸°í•´ì•¼ í•¨.






                         OAuth 2.0 - Token Revocation
                      
                                                           Token EP
                            /ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡â†’  Authorization  
                     Get Access token                                â†—  Server          
                          /                                         /  (Google)      
                         /                                         /     
                        /                                        /Revocation EP  
                       /                                        /    
                      /                   Revoke Token         /
    ğŸ’»  ã…¡ã…¡ã…¡â†’  Client    ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡/      
   User         Application                                                
   Agent        (Shutterfly)                                                
     â†‘             |                                                     
     |             |                                                    
     |             |     Call RESP API with Access Token                
    ğŸ™â€â™‚ï¸            |          (Returns Photos List)                        
  Resource         |ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡â†’  Resource Server  
   Owner                                                           (Google Photos API)



ì‚¬ìš©ìê°€ ë¡œê·¸ì•„ì›ƒí•˜ë©´ í´ë¼ì´ì–¸íŠ¸ëŠ” Revocation Endpointì— Access/Refresh Tokenì„ ì „ë‹¬í•´ í† í°ì„ ë¬´íš¨í™”í•´ì•¼ í•œë‹¤. 
ê·¸ë ‡ì§€ ì•Šìœ¼ë©´ í† í° ìœ íš¨ ê¸°ê°„ ë‚´ ë¶ˆë²• ì‚¬ìš© ê°€ëŠ¥ì„±ì´ ì¡´ì¬í•œë‹¤.



OAuthëŠ” ë‹¤ì–‘í•œ í”Œë«í¼ì„ ìœ„í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ì¡´ì¬í•˜ì§€ë§Œ, íë¦„ì„ ì´í•´í•´ì•¼ ë””ë²„ê¹…ê³¼ ë³´ì•ˆ ì„¤ì •ì´ ì •í™•í•´ì§„ë‹¤.
